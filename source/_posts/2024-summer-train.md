---
title: 2024 暑假训练（2024-08-18~）
date: 2024-08-20 07:19:16
tags: [OI, 训练总结]
categories: [OI]
thumbnail: https://cdn.luogu.com.cn/upload/image_hosting/y9953y5v.png
mathjax: true
---

因为每次建一个文章太麻烦，所以整合到一起了。

## 2024-08-18

### [want](https://gmoj.net/senior/#contest/show/4213/0)

比较签到的题，本质是把前两步暴力出来然后连边找环。所有环长的 lcm 就是答案。

这个感觉还可以优化，因为前两步模拟太浪费了，而每一步有很多重复的，可以加强。

至于怎么加强，以后再细想一下。

【TODO】

### [to](https://gmoj.net/senior/#contest/show/4213/1)

求一个表达式的期望值，每个数互不相同。

学到了一个东西：期望可加：$E(X+Y)=E(X)+E(Y)$。

也就是：$E(abc+abd)=E(abc)+E(abd)$。

很神奇，然后两个部分就互不影响了。

### [分数](https://gmoj.net/senior/#contest/show/4213/2)

求繁分式的一部分的值。

应该会有一个直观的感受，可以建出一个分治树，然后树上做：$O(q dep)$。

但是我们发现 $[l,r]$ 的答案就是 $l-1$ 的点到 $lca$ 的链上所有不在该链上的右儿子，与 $r+1$  的点到 $lca$ 的链上所有不在该链上的左儿子。

```  
           *
          / \
         *   *
        / \ / \
        * B C *
       / \   / \
     l-1 A  r+1 *
```

字母的都是答案，那么就是 $AB^{-1}C^{-1}$。

然后 $l-1$ 的答案是 $AB^{-1}C^{-1}D^{-1}E^{-1}F^{-1}\cdots$ 的。

$r+1$ 的答案是 $A^{-1}BC^{-1}DE^{-1}F\cdots$ 的。

大力维护就好了，注意如果 $l-1$ 不存在那么 $r+1$ 的答案要取负数。

这是一种分治优化的套路，建出分治树然后用 $l-1$ 和 $r+1$ 与它们的 $lca$ 计算答案。答案就是链上所有不在该链上的左/右儿子。

还有一个优化：这道题不需要再用 st 表求 lca，不然会爆空间。这里分治的 `mid` 是区间最大值，所以我们可以求 $l-1$ 与 $r+1$ 区间最大值找到 $mid$ 是这个值的节点就可以了。

---

$O(n)$ rmq：本质就是分块，见由乃救爷爷。